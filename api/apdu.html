<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#"><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <title>Keycard</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://dev-keycard.status.im/api/apdu.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="https://dev-keycard.status.im/api/apdu.html">
    
  
  <!-- Icon -->
  <meta name="msapplication-TileColor" content="#ff9c00">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">

  <link rel="icon" type="image/png" href="/img/logo-16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/img/logo-32.png" sizes="32x32">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76.png?v=0.0.5">
  <link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120.png?v=0.0.5">
  <link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152.png?v=0.0.5">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180.png?v=0.0.5">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon-1024.png?v=0.0.5">
  <link rel="stylesheet" href="/css/main.min.css">
  <link rel="alternate" href="/atom.xml" title="Keycard">
  <meta property="og:title" content="Status Incubate: helping #buidl web3">
</head>

<body>
  <div id="container">
    
      <div class="header">
    <div class="header-left">
        <a class="logo" href="/"></a>
        
<ul class="main-nav">
    <li class="item--to-show"><a href="https://status.im/get" class="">App</a></li>
    <li class="item--to-show"> <a href="https://our.status.im/">Blog</a> </li>
    <li class="item--to-show"> <a href="https://status.im/docs">Docs</a></li>
    <li class="item--dropdown item--dropdown-projects"> <a href="#" class="">Projects</a></li>
    <li><a href="https://status.im/contribute">Contribute</a></li>
    <li class="item--dropdown"><a href="#" class="item--dropdown-community">Community</a></li>
    <li class="item--more"><a href="#" class="item--more">More</a></li>
</ul>

    </div>
    <div class="header-right">
        <a href="http://get.status.im/chat/public/status-incubate" class="button button--secondary" style="margin-right: 8px">Join Status Chat</a>
    </div>
</div>

<div class="mobile-nav-wrap">
    <div class="mobile-nav-inner">
        <a class="logo" href="/"></a>
        <a class="icon-close mobile-nav-close" href="#"></a>
        <ul class="mobile-nav">
            <li><a href="https://our.status.im/tag/incubate/">Blog</a></li>
            <li><a href="https://status.im/docs">Docs</a></li>
            <li class="item--dropdown item--to-show">
              <span>Projects</span>
              <ul class="mobile-sub-nav">
                <li><a href="https://incubate.status.im/" class="">Incubate</a></li>
                <li><a href="https://nimbus.status.im/" class="">Nimbus</a></li>
                <li><a href="https://embark.status.im/" class="">Embark</a></li>
                <li><a href="https://hardwallet.status.im/" class="">Keycard</a></li>
              </ul>
            </li>
            <li><a href="https://status.im/contribute/" class="">Contribute</a></li>
        </ul>
        <div class="mobile-nav-footer">
            <a href="http://get.status.im/chat/public/status-incubate" class="button button--secondary">Join Status Chat</a>
        </div>
        <header class="dropdown">
            <nav>
                
<ul class="main-nav">
    <li class="item--to-show"><a href="https://status.im/get" class="">App</a></li>
    <li class="item--to-show"> <a href="https://our.status.im/">Blog</a> </li>
    <li class="item--to-show"> <a href="https://status.im/docs">Docs</a></li>
    <li class="item--dropdown item--dropdown-projects"> <a href="#" class="">Projects</a></li>
    <li><a href="https://status.im/contribute">Contribute</a></li>
    <li class="item--dropdown"><a href="#" class="item--dropdown-community">Community</a></li>
    <li class="item--more"><a href="#" class="item--more">More</a></li>
</ul>

            </nav>
        </header>
    </div>
    <div class="popup-overlay"></div>
</div>

<div class="popup-wrap popup-wrap--community">
    <div class="popup popup--community">
        <a class="popup__button popup__button--close"></a>
        <h3 class="popup__title">Community</h3>
        <div class="popup__inner">
            <div class="cards cards--three cards--three--even cards--community cards--community--light">
                <div class="card">
                    <a href="https://get.status.im/chat/public/status" class="card-inner">
                        <div class="community-icon community-icon--join"></div>
                        <h4>Join the chat in Status</h4>
                        <p class="secondary-text">Whisper sweet, encrypted nothings on a distributed network that no-one owns.</p>
                    </a>
                </div>
                <div class="card">
                    <a href="https://discuss.status.im/" class="card-inner">
                        <div class="community-icon community-icon--discussion"></div>
                        <h4>Join the Discussion</h4>
                        <p class="secondary-text">Join longer discussions, work in progress, and our research here.</p>
                    </a>
                </div>
                <div class="card">
                    <a href="https://github.com/status-im/" class="card-inner">
                        <div class="community-icon community-icon--contrubute"></div>
                        <h4>Contribute to our Repos</h4>
                        <p class="secondary-text">Help us #buidl the future by getting involved in the most active code base in Ethereum.</p>
                    </a>
                </div>
            </div>
            <h5>Find Out More</h5>
            <div class="cards cards-community-more cards--three cards--three--even">
                <div class="card">
                    <div class="card-inner">
                        <div class="card-content">
                            <div class="latest-posts latest-news"></div>
                        </div>
                        <div class="card-community-more__link"><a href="https://our.status.im/" class="link-arrow">Learn more</a></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-inner">
                        <div class="card-content">
                            <h4>Life at Status</h4>
                            <p class="secondary-text">What's it like to live the decentralized lifestyle? Find out here.</p>
                        </div>
                        <div class="card-community-more__link"><a href="https://status.im/contribute/" class="link-arrow">Learn more</a></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-inner">
                        <div class="card-content">
                            <h4>Follow us on Twitter</h4>
                            <p class="secondary-text">Join the conversation on our social channels to learn more.</p>
                        </div>
                        <div class="card-community-more__link"><a href="https://twitter.com/ethstatus/" class="link-arrow">Learn more</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="popup-overlay"></div>
</div>

<div class="popup-wrap popup-wrap--projects">
    <div class="popup popup--projects">
        <a class="popup__button popup__button--close"></a>
        <h3 class="popup__title">Projects</h3>
        <div class="popup__inner">
            <h5>Help us #buidl</h5>
            <div class="cards cards-community-more cards--three cards--three--even">
                <div class="card">
                    <div class="card-inner">
                        <div class="card-content">
                            <h4>Embark</h4>
                            <p class="secondary-text">Embark is a simple and easy to use development framework that enables you to build and deploy your own decentralized applications smoothly.</p>
                        </div>
                        <div class="card-community-more__link"><a href="https://embark.status.im/" class="link-arrow">Learn more</a></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-inner">
                        <div class="card-content">
                            <h4>Nimbus</h4>
                            <p class="secondary-text">A research project and light client for Ethereum 2.0 designed to perform well on embedded systems and resource-restricted hardware.</p>
                        </div>
                        <div class="card-community-more__link"><a href="https://nimbus.status.im" class="link-arrow">Learn more</a></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-inner">
                        <div class="card-content">
                            <h4>Keycard</h4>
                            <p class="secondary-text">A hardware wallet in the form of a card with a safe, contactless transaction experience</p>
                        </div>
                        <div class="card-community-more__link"><a href="https://hardwallet.status.im/" class="link-arrow">Learn more</a></div>
                    </div>
                </div>
            </div>
            <div class="separator"></div>
            <h5>Enable Everyone</h5>
            <div class="cards cards-community-more cards--three cards--three--even">
                <div class="card">
                    <div class="card-inner">
                        <div class="card-content">
                            <h4>Incubate</h4>
                            <p class="secondary-text">Incubate supports open source, early stage startups with funding, technical mentorship, legal and regulatory compliance and much more.</p>
                        </div>
                        <div class="card-community-more__link"><a href="https://incubate.status.im/" class="link-arrow">Learn more</a></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-inner">
                        <div class="card-content">
                            <h4>Statusphere</h4>
                            <p class="secondary-text">Get involved in our community today, no matter who you are.</p>
                        </div>
                        <div class="card-community-more__link"><a href="https://status.im/statusphere/" class="link-arrow">Learn more</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="popup-overlay"></div>
</div>

    
    <div class="site-specific-menu">
    <p>
        <a class="site-name" href="/">Keycard</a>
        <a class="specific-nav-link" href="/api/"><span>API</span></a>
    </p>
</div>
<div class="page-intro wrapper">
  <header class="article-header">
    <h1 class="article-title" itemprop="name"></h1>
    <a href="https://github.com/status-im/incubate.status.im/edit/develop/source/api/apdu.md" class="article-edit-link" title="Improve this doc">Edit on Github</a>
  </header>
</div>
<div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
    <aside id="sidebar" role="navigation">
  <div class="inner">
    <strong class="sidebar-title">Keycard API</strong><a href="index.html" class="sidebar-link">Getting Started</a><a href="java-sdk.html" class="sidebar-link">Java SDK</a><a href="apdu.html" class="sidebar-link current">APDU Protocol</a>
  </div>
</aside>
      <article class="article-container" itemscope="" itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <div class="article-content" itemprop="articleBody">
                <h1 id="Status-Keycard-Protocol" class="article-heading"><a href="#Status-Keycard-Protocol" class="headerlink" title="Status Keycard Protocol"></a>Status Keycard Protocol<a class="article-anchor" href="#Status-Keycard-Protocol" aria-hidden="true"></a></h1><p>These are the commands supported by the application. When a command has a precondition clause and these are not met the SW 0x6985 is returned. All tagged data structures are encoded in the <a href="http://www.cardwerk.com/smartcards/smartcard_standard_ISO7816-4_annex-d.aspx" target="_blank" rel="noopener">BER-TLV format</a> </p>
<h2 id="SELECT" class="article-heading"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT<a class="article-anchor" href="#SELECT" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x00</li>
<li>INS = 0xA4</li>
<li>P1 = 0x04</li>
<li>P2 = 0x00</li>
<li>Data = the instance AID</li>
<li>Response = Application Info Template or ECC public key.</li>
</ul>
<p>Response Data format:</p>
<ul>
<li>Tag 0xA4 = Application Info Template<ul>
<li>Tag 0x8F = Instance UID (16 bytes)</li>
<li>Tag 0x80 = ECC public Key</li>
<li>Tag 0x02 = Application Version (2 bytes)</li>
<li>Tag 0x02 = Number of remaining pairing slots (1 byte)</li>
<li>Tag 0x8E = Key UID (0 or 32 bytes)</li>
</ul>
</li>
</ul>
<p>The SELECT command is documented in the ISO 7816-4 specifications and is used to select the application on the card, making it the active one. The data field is the AID of the application. The response is the Application Info template which contains the instance UID (which can be used by the client to keep track of multiple cards) and the public key which must be used by the client to establish the Secure Channel. Additionally it contains the version number of the application, formatted on two bytes. The first byte is the major version and the second is the minor version (e.g: version 1.1 is formatted as 0x0101). The number of remaining pairing slots is also included in the response.</p>
<p>The Key UID can be either empty (when no key is loaded on card) or the SHA-256 hash of the master public key.</p>
<p>When the applet is in pre-initializated state, it only returns the ECC public key, BER-TLV encoded with tag 0x80.</p>
<h2 id="INIT" class="article-heading"><a href="#INIT" class="headerlink" title="INIT"></a>INIT<a class="article-anchor" href="#INIT" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xFE</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Data = EC public key (LV encoded) | IV | encrypted payload</li>
<li>Response SW = 0x9000 on success, 0x6D00 if the applet is already initialized, 0x6A80 if the data is invalid</li>
</ul>
<p>This command is only available when the applet is in pre-initialized state and successful execution brings the applet in the initialized state. This command is needed to allow securely storing secrets on the applet at a different moment and place than installation is taking place. Currently these are the PIN, PUK and pairing password.</p>
<p>The client must take the public key received after the SELECT command, generate a random keypair and perform EC-DH to generate an AES key. It must then generate a random IV and encrypt the payload using AES-CBC with ISO/IEC 9797-1 Method 2 padding.</p>
<p>They payload is the concatenation of the PIN (6 digits/bytes), PUK (12 digits/bytes) and pairing secret (32 bytes).</p>
<p>This scheme guarantees protection against passive MITM attacks. Since the applet has no “owner” before the execution of this command, protection against active MITM cannot be provided at this stage. However since the communication happens locally (either through NFC or contacted interface) the realization of such an attack at this point is unrealistic.</p>
<p>After successful execution, this command cannot be executed anymore. The regular SecureChannel (with pairing) is active and PIN and PUK are initialized.</p>
<h2 id="OPEN-SECURE-CHANNEL" class="article-heading"><a href="#OPEN-SECURE-CHANNEL" class="headerlink" title="OPEN SECURE CHANNEL"></a>OPEN SECURE CHANNEL<a class="article-anchor" href="#OPEN-SECURE-CHANNEL" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0x10</li>
<li>P1 = the pairing index</li>
<li>P2 = 0x00</li>
<li>Data = An EC-256 public key on the SECP256k1 curve encoded as an uncompressed point.</li>
<li>Response Data = A 256-bit salt and a 128-bit seed IV</li>
<li>Response SW = 0x9000 on success, 0x6A86 if P1 is invalid, 0x6A80 if the data is not a public key</li>
</ul>
<p>This APDU is the first step to establish a Secure Channel session. A session is aborted when the application is deselected, either directly or because of a card reset/tear.</p>
<p>The card generates a random 256-bit salt which is sent to the client. Both the client and the card do the following for key derivation</p>
<ol>
<li>Use their private key and the counterpart public key to generate a secret using the EC-DH algorithm.</li>
<li>The generated secret, the pairing key and the salt are concatenated and the SHA-512 of the concatenated value is calculated.</li>
<li>The output of the SHA-512 algorithm is split in two parts of 256-bit. The first part is used as the encryption key and the second part is used as the MAC key for further communication.</li>
</ol>
<p>The seed IV is used by the client as the IV for the next encrypted APDU.</p>
<h2 id="MUTUALLY-AUTHENTICATE" class="article-heading"><a href="#MUTUALLY-AUTHENTICATE" class="headerlink" title="MUTUALLY AUTHENTICATE"></a>MUTUALLY AUTHENTICATE<a class="article-anchor" href="#MUTUALLY-AUTHENTICATE" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0x11</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Data = 256-bit random number</li>
<li>Response Data = 256-bit random number</li>
<li>Response SW = 0x9000 on success, 0x6985 if the previous successfully executed APDU was not OPEN SECURE CHANNEL, 0x6982 if authentication failed or the data is not 256-bit long</li>
</ul>
<p>This APDU allows both parties to verify that the keys generated in the OPEN SECURE CHANNEL step are matching and thus guarantee authentication of the counterpart. The data sent by both parties is a 256-bit random number The APDU data is sent encrypted with the keys generated in the OPEN SECURE CHANNEL step. Each party must verify the MAC of the received APDU. If the MAC can be verified, it means that both parties are using the same keys. Only after this step has been executed the secure channel can be considered to be open and other commands can be sent. If the authentication fails the card must respond with 0x6982. In this case the OPEN SECURE CHANNEL command must be repeated to generate new keys.</p>
<h2 id="PAIR" class="article-heading"><a href="#PAIR" class="headerlink" title="PAIR"></a>PAIR<a class="article-anchor" href="#PAIR" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0x12</li>
<li>P1 = pairing phase</li>
<li>P2 = 0x00</li>
<li>Data = see below</li>
<li>Response Data = see below</li>
<li>Response SW = 0x9000 on success, 0x6A80 if the data is in the wrong format, 0x6982 if client cryptogram verification fails, 0x6A84 if all available pairing slot are taken, 0x6A86 if P1 is invalid or is 0x01 but the first phase was not completed, 0x6985 if a secure channel is open</li>
</ul>
<p>P1:</p>
<ul>
<li>0x00: First step</li>
<li>0x01: Final step</li>
</ul>
<p>Data:</p>
<ul>
<li>On first step: a 256-bit random client challenge</li>
<li>On second step: the client cryptogram as SHA-256(shared secret, card challenge)</li>
</ul>
<p>Response Data:</p>
<ul>
<li>On first step: the card cryptogram as SHA-256(shared secret, client challenge) followed by a 256-bit card challenge</li>
<li>On second step: the pairing index followed by a 256-bit salt</li>
</ul>
<p>This APDU is sent to pair a client. Pairing is performed with two commands which must be sent immediately one after the other. </p>
<p>In the first phase the client sends a random challenge to the card. The card replies with the SHA-256 hash of the challenge and the shared secret followed by its random challenge. The client is thus able to authenticate the card by verifying the card cryptogram (since the client can generate the same and verify that it matches).</p>
<p>In the second phase the client sends the client cryptogram which is the SHA-256 hash of the shared secret and the card challenge. The card verifies the cryptogram and thus authenticates the client. On success the card generates a random 256-bit salt which is appended to the shared secret. The SHA-256 hash of the concatenated value is stored in the first available pairing slot and will be further used to derive session keys. The card responds with the pairing index (which the client must send in all OPEN SECURE CHANNEL commands) and the salt used to generate the key, so that the client can generate and store the same key.</p>
<p>The shared secret is a 256-bit value which must be be known to both parts being paired.</p>
<h2 id="UNPAIR" class="article-heading"><a href="#UNPAIR" class="headerlink" title="UNPAIR"></a>UNPAIR<a class="article-anchor" href="#UNPAIR" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0x13</li>
<li>P1 = the index to unpair</li>
<li>P2 = 0x00</li>
<li>Response SW = 0x9000 on success, 0x6985 if security conditions are not met, 0x6A86 if the index is higher than the<br>highest possible pairing index.</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified</li>
</ul>
<p>This APDU is sent to unpair a client. An existing secure channel session must be open. The application implementing this protocol may apply additional restrictions, such as the verification of a user PIN. On success the pairing slot at the  given index will be freed and will be made available to pair other clients. If the index is already free nothing will happen.</p>
<h2 id="GET-STATUS" class="article-heading"><a href="#GET-STATUS" class="headerlink" title="GET STATUS"></a>GET STATUS<a class="article-anchor" href="#GET-STATUS" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xF2</li>
<li>P1 = 0x00 for application status, 0x01 for key path status</li>
<li>P2 = 0x00</li>
<li>Response SW = 0x9000 on success, 0x6A86 on undefined P1</li>
<li>Response Data = Application Status Template or Key Path</li>
<li>Preconditions: Secure Channel must be opened</li>
</ul>
<p>Response Data format:<br>if P1 = 0x00:</p>
<ul>
<li>Tag 0xA3 = Application Status Template<ul>
<li>Tag 0x02 = PIN retry count (1 byte)</li>
<li>Tag 0x02 = PUK retry count (1 byte)</li>
<li>Tag 0x01 = 0xff if key is initialized, 0 otherwise</li>
</ul>
</li>
</ul>
<p>if P1 = 0x01:</p>
<ul>
<li>a sequence of 32-bit numbers indicating the current key path. Empty if master key is selected.</li>
</ul>
<h2 id="SET-NDEF" class="article-heading"><a href="#SET-NDEF" class="headerlink" title="SET NDEF"></a>SET NDEF<a class="article-anchor" href="#SET-NDEF" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xF3</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Data = the data to store</li>
<li>Response SW = 0x9000 on success, 0x6A80 on invalid data</li>
<li>Preconditions: Secure Channel must be opened, PIN must be verified</li>
</ul>
<p>Used to set the content of the data file owned by the NDEF applet. This allows changing the behavior of Android and other clients when tapping the card with no open client. As an example, it could be used to launch a specific wallet software.</p>
<p>The data is stored as is. A check is made that the first 2 bytes, read as a MSB first short, are equal to the Lc field minus 2 (the length of the field itself). This does not ensure that the NDEF record is valid, but ensures that no out of bound access happens.</p>
<h2 id="VERIFY-PIN" class="article-heading"><a href="#VERIFY-PIN" class="headerlink" title="VERIFY PIN"></a>VERIFY PIN<a class="article-anchor" href="#VERIFY-PIN" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0x20</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Data = the PIN to be verified</li>
<li>Response SW = 0x9000 on success, 0x63CX on failure, where X is the number of attempt remaining</li>
<li>Preconditions: Secure Channel must be opened</li>
</ul>
<p>Used to verify the user PIN. On correct PIN entry the card returns 0x9000, the retry counter is reset and the PIN is marked as authenticated for the entire session (until the application is deselected or the card reset/teared). On error, the number of remaining retries is decreased and the SW 0x63CX, where X is the number of available retries is returned. When the number of remaining retries reaches 0 the PIN is blocked. When the PIN is blocked this command always returns 0x63C0, even if the PIN is inserted correctly.</p>
<h2 id="CHANGE-PIN" class="article-heading"><a href="#CHANGE-PIN" class="headerlink" title="CHANGE PIN"></a>CHANGE PIN<a class="article-anchor" href="#CHANGE-PIN" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0x21</li>
<li>P1 = PIN identifier</li>
<li>P2 = 0x00</li>
<li>Data = the new PIN</li>
<li>Response SW = 0x9000 on success, 0x6A80 if the PIN format is invalid, 0x6A86 if P1 is invalid</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified</li>
</ul>
<p>Used to change a PIN or secret. In case of invalid format, the code 0x6A80 is returned. If the conditions match, the PIN or secret is updated. The no-error SW 0x9000 is returned.</p>
<p>P1:</p>
<ul>
<li>0x00: User PIN. Must be 6-digits. The updated PIN is authenticated for the rest of the session. </li>
<li>0x01: Applet PUK. Must be 12-digits.</li>
<li>0x02: Pairing secret. Must be 32-bytes long. Existing pairings are not broken, but new pairings will need to use the new secret.</li>
</ul>
<h2 id="UNBLOCK-PIN" class="article-heading"><a href="#UNBLOCK-PIN" class="headerlink" title="UNBLOCK PIN"></a>UNBLOCK PIN<a class="article-anchor" href="#UNBLOCK-PIN" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0x22</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Data = the PUK followed by the new PIN</li>
<li>Response SW = 0x9000 on success, 0x6A80 if the format is invalid</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be blocked</li>
</ul>
<p>Used to unblock the user PIN. The data field must contain exactly 18 numeric digits, otherwise SW 0x6A80 is returned. The first 12 digits are the PUK and the last 6 are the new PIN. If the PUK is correct the PIN is changed to the supplied one, it is unblocked and authenticated for the rest of the session. The status code 0x9000 is returned. When the PUK is wrong, the number of remaining retries is decreased and the SW 0x63CX, where X is the number of available retries is returned. When the number of remaining retries reaches 0 the PUK is blocked. When the PUK is blocked this command always returns 0x63C0, even if the PUK is inserted correctly. In this case the wallet is effectively lost.</p>
<h2 id="LOAD-KEY" class="article-heading"><a href="#LOAD-KEY" class="headerlink" title="LOAD KEY"></a>LOAD KEY<a class="article-anchor" href="#LOAD-KEY" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xD0</li>
<li>P1 = key type</li>
<li>P2 = 0x00</li>
<li>Data = the key data</li>
<li>Response SW = 0x9000 on success, 0x6A80 if the format is invalid, 0x6A86 if P1 is invalid</li>
<li>Response Data = the key UID, defined as the SHA-256 of the public key</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified</li>
</ul>
<p>P1:</p>
<ul>
<li>0x01 = ECC SECP256k1 keypair</li>
<li>0x02 = ECC SECP256k1 extended keypair</li>
<li>0x03 = Binary seed as defined in <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" target="_blank" rel="noopener">BIP39</a></li>
</ul>
<p>Data:</p>
<p>If P1 is 0x01 or 0x02</p>
<ul>
<li>Tag 0xA1 = keypair template<ul>
<li>Tag 0x80 = ECC public key component (can be omitted)</li>
<li>Tag 0x81 = ECC private key component</li>
<li>Tag 0x82 = chain code (if P1=0x02)</li>
</ul>
</li>
</ul>
<p>If P1 is 0x03 a 64 byte sequence generated according to the BIP39 specifications is expected. The master key will be generated according to the <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener">BIP32</a> specifications. This is only supported if the hardware supports public key derivation.</p>
<p>This command is used to load or replace the keypair used for signing on the card. This command always aborts open signing sessions, if any. Unless a DERIVE KEY is sent, a subsequent SIGN command will use this keypair for signature.</p>
<h2 id="DERIVE-KEY" class="article-heading"><a href="#DERIVE-KEY" class="headerlink" title="DERIVE KEY"></a>DERIVE KEY<a class="article-anchor" href="#DERIVE-KEY" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xD1</li>
<li>P1 = derivation options</li>
<li>P2 = 0x00</li>
<li>Data = a sequence of 32-bit integers (most significant byte first). Empty if the master key must be used.</li>
<li>Response SW = 0x9000 on success, 0x6A80 if the format is invalid, 0x6984 if one of the components in the path generates an invalid key, 0x6B00 if derivation from parent keys is selected but no valid parent key is cached.</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified (if no PIN-less key is defined), an extended keyset must be loaded</li>
</ul>
<p>This command is used before a signing session to generate a private key according to the <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener">BIP32</a> specifications. This command always aborts open signing sessions, if any. The generated key is used for all subsequent SIGN sessions. The maximum depth of derivation from the master key is 10. Any attempt to get deeper results in 0x6A80 being returned. The BIP32 specifications define a few checks which must be performed on the derived keys. If these fail, the 0x6984 is returned and the invalid key is discarded. A client should perform a GET STATUS command to get the actual current key path and resume derivation using a different path.</p>
<p>The ability to start derivation from the parent keys allows to more efficiently switch between children of the same key. Note however that only the immediate parent of the current key is cached so you cannot use this to go back in the hierarchy. If no valid parent key is available the status code 0x6B00 will be returned.</p>
<p>P1:</p>
<ul>
<li>bit 0-5 = reserved</li>
<li>bit 7-6:<ul>
<li>00 derive from master keys</li>
<li>01 derive from parent keys</li>
<li>10 derive from current keys</li>
<li>11 reserved</li>
</ul>
</li>
</ul>
<h2 id="GENERATE-MNEMONIC" class="article-heading"><a href="#GENERATE-MNEMONIC" class="headerlink" title="GENERATE MNEMONIC"></a>GENERATE MNEMONIC<a class="article-anchor" href="#GENERATE-MNEMONIC" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xD2</li>
<li>P1 = checksum size (between 4 and 8)</li>
<li>P2 = 0x00</li>
<li>Response SW = 0x9000 on success. 0x6A86 if P1 is invalid.</li>
<li>Response Data = a sequence of 16-bit integers (most significant byte first).</li>
<li>Preconditions: Secure Channel must be opened</li>
</ul>
<p>Used to generate a mnemonic according to the algorithm specified in <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" target="_blank" rel="noopener">BIP39</a>. The returned data is a list of 16-byte integers which should be used as indexes in a wordlist to generate the human-readable mnemonic. Each integer can have a value from 0 to 2047.</p>
<h2 id="REMOVE-KEY" class="article-heading"><a href="#REMOVE-KEY" class="headerlink" title="REMOVE KEY"></a>REMOVE KEY<a class="article-anchor" href="#REMOVE-KEY" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xD3</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Response SW = 0x9000 on success.</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified</li>
</ul>
<p>Removes the key from the card, bringing it back to an uninitialized state. No signing operation is possible after this command until a new LOAD KEY command is performed.</p>
<h2 id="GENERATE-KEY" class="article-heading"><a href="#GENERATE-KEY" class="headerlink" title="GENERATE KEY"></a>GENERATE KEY<a class="article-anchor" href="#GENERATE-KEY" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xD4</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Response SW = 0x9000 on success.</li>
<li>Response Data = the key UID, defined as the SHA-256 of the public key</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified</li>
</ul>
<p>Generates and stores keys completely on card. The state of the card after execution is the same as if a LOAD KEY command had been performed.</p>
<h2 id="DUPLICATE-KEY" class="article-heading"><a href="#DUPLICATE-KEY" class="headerlink" title="DUPLICATE KEY"></a>DUPLICATE KEY<a class="article-anchor" href="#DUPLICATE-KEY" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xD5</li>
<li>P1 = subcommand</li>
<li>P2 = depends on subcommand</li>
<li>Data = depends on phase</li>
<li>Response SW = 0x9000 on success.</li>
<li>Response Data = depends on subcommand</li>
<li>Preconditions: depends on subcommand</li>
</ul>
<p>P1:</p>
<ul>
<li>0x00: START DUPLICATE</li>
<li>0x01: ADD ENTROPY</li>
<li>0x02: EXPORT DUPLICATE</li>
<li>0x03: IMPORT DUPLICATE</li>
</ul>
<h3 id="START-DUPLICATE" class="article-heading"><a href="#START-DUPLICATE" class="headerlink" title="START DUPLICATE"></a>START DUPLICATE<a class="article-anchor" href="#START-DUPLICATE" aria-hidden="true"></a></h3><p>This is the first step to start duplication. Requires an open secure channel and user PIN must be verified. Aborts any on-going duplication session. P2 is the number of entropy pieces to expect in total (including this command). The data contain the first piece of entropy. Returns no data. Must be performed with exactly the same parameters and data on all cards taking part in the duplication.</p>
<h3 id="ADD-ENTROPY" class="article-heading"><a href="#ADD-ENTROPY" class="headerlink" title="ADD ENTROPY"></a>ADD ENTROPY<a class="article-anchor" href="#ADD-ENTROPY" aria-hidden="true"></a></h3><p>This command uses the same one-shot secure channel scheme as defined in the INIT command. P2 is 00. Requires an ongoing duplicate session started with the START DUPLICATE subcommand. Must be performed once per device taking part in the duplication process, for a total number of devices equaling the P2 parameter of the START DUPLICATE subcommand (counting the device which sent the START DUPLICATE command as the first device). The data is a random 256-bit number. The same data must be sent to all the cards taking part in the duplication process.</p>
<h3 id="EXPORT-DUPLICATE" class="article-heading"><a href="#EXPORT-DUPLICATE" class="headerlink" title="EXPORT DUPLICATE"></a>EXPORT DUPLICATE<a class="article-anchor" href="#EXPORT-DUPLICATE" aria-hidden="true"></a></h3><p>This command must be sent to the card which you wish to duplicate. Requires an open secure channel and authenticated PIN. Works only if a duplication session is active and ADD ENTROPY has been performed the required number of times. Returns the encrypted duplicate of the master key and terminates the duplication session for this card. The format is exactly the same as the one defined in the LOAD KEY (TLV) command with omitted public key. It is however prepended by a 16-bytes IV and the entire TLV structure is encrypted.</p>
<h3 id="IMPORT-DUPLICATE" class="article-heading"><a href="#IMPORT-DUPLICATE" class="headerlink" title="IMPORT DUPLICATE"></a>IMPORT DUPLICATE<a class="article-anchor" href="#IMPORT-DUPLICATE" aria-hidden="true"></a></h3><p>This command must be sent to all the cards which are a target for duplication. The Data field must contain the output from the EXPORT DUPLICATE command performed on the source card. Returns the key UID. It follows exactly the same rules as the EXPORT DUPLICATE subcommand.</p>
<h2 id="SIGN" class="article-heading"><a href="#SIGN" class="headerlink" title="SIGN"></a>SIGN<a class="article-anchor" href="#SIGN" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xC0</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Data = the hash to sign</li>
<li>Response = public key and the signature</li>
<li>Response SW = 0x9000 on success, 0x6A80 if the data is not 32-byte long</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified (or a PIN-less key must be active), a valid keypair must be loaded</li>
</ul>
<p>Response Data format:</p>
<ul>
<li>Tag 0xA0 = signature template<ul>
<li>Tag 0x80 = ECC public key component</li>
<li>Tag 0x30 = ECDSA Signature<ul>
<li>Tag 0x02 = R value</li>
<li>Tag 0x02 = S value</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Returns the ECDSA signature of the hash. The hash can be calculated using any algorithm, but must be 32-bytes long. The signature is returned in a signature template, containing the public key associated to the signature and the signature itself. For usage on the blockchain, you will need to calculate the recovery ID in addition to extracting R and S. To calculate the recovery ID you need to apply the same algorithm used for public key recovery from a transaction starting with a recovery ID of 0. If the public key matches the one returned in the template, then you have found the recovery ID, otherwise you try again by incrementing the recovery ID.</p>
<h2 id="SET-PINLESS-PATH" class="article-heading"><a href="#SET-PINLESS-PATH" class="headerlink" title="SET PINLESS PATH"></a>SET PINLESS PATH<a class="article-anchor" href="#SET-PINLESS-PATH" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xC1</li>
<li>P1 = 0x00</li>
<li>P2 = 0x00</li>
<li>Data = a sequence of 32-bit integers</li>
<li>Response SW = 0x9000 on success, 0x6A80 if data is invalid</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified</li>
</ul>
<p>Sets the given sequence of 32-bit integers as a PIN-less path. When the current derived key matches this path, SIGN will work even if no PIN authentication has been performed. An empty sequence means that no PIN-less path is defined.</p>
<h2 id="EXPORT-KEY" class="article-heading"><a href="#EXPORT-KEY" class="headerlink" title="EXPORT KEY"></a>EXPORT KEY<a class="article-anchor" href="#EXPORT-KEY" aria-hidden="true"></a></h2><ul>
<li>CLA = 0x80</li>
<li>INS = 0xC2</li>
<li>P1 = derivation options</li>
<li>P2 = export options</li>
<li>Response SW = 0x9000 on success, 0x6A86 if P1 or P2 are wrong</li>
<li>Data = a sequence of 32-bit integers (empty if P1=0x00)</li>
<li>Response Data = key pair template</li>
<li>Response SW = 0x9000 on success, 0x6985 if the private key cannot be exported, 0x6A80 if the path is malformed</li>
<li>Preconditions: Secure Channel must be opened, user PIN must be verified</li>
</ul>
<p>P1:<br>0x00 = Current key<br>0x01 = Derive<br>0x02 = Derive and make current</p>
<p>P2:<br>0x00 = private and public key<br>0x01 = public key only</p>
<p>Response Data format:</p>
<ul>
<li>Tag 0xA1 = keypair template<ul>
<li>Tag 0x80 = ECC public key component (could be omitted)</li>
<li>Tag 0x81 = ECC private key component (if P2=0x00)</li>
</ul>
</li>
</ul>
<p>This command exports the requested public and private key. The public key can be always exported (P2=0x01), but the private key (P2=0x00) can be exported if and only if the requested key path is in the <a href="https://eips.ethereum.org/EIPS/eip-1581" target="_blank" rel="noopener">EIP-1581</a> subtree. </p>
<p>The P1 parameter indicates how to the derive the desired key. P1 = 0x00 indicates that the current key must be exported, and no derivation will be performed. P1 = 0x01 derives the path given in the data field without changing the current path of the card. P1 = 0x02 derives the path but also changes the current path of the card. The source for derivation can be set by OR’ing P1 with the constants defined in the DERIVE KEY command. This allows deriving from master, parent or current.</p>
<p>If the private key is being exported, the card could omit exporting the public key for performance reason. The public key can then be calculate off-card if needed.</p>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2019-01-17T09:53:56.190Z" itemprop="dateModified">Last updated: 2019-01-17</time>
                <a href="java-sdk.html" class="article-footer-prev" title="Java SDK"><i class="fa fa-chevron-left"></i><span>Prev</span></a>
              </footer>
            </div>
          </div>
        </div>
      </article>
    </div>
  </div>
</div>

    
<div class="footer footer--global">
    <div class="footer-inner">
        <div class="footer-table">
            <div class="footer-table__column">
                <p class="footer-header">Social links</p>
                <ul class="footer-list">
                    <li class="footer-link footer-link--fb"><a href="https://www.facebook.com/ethstatus" target="_blank"><span class="footer-icon"></span><span class="footer-link-label">Facebook</span></a></li>
                    <li class="footer-link footer-link--tw"><a href="https://twitter.com/ethstatus" target="_blank"><span class="footer-icon"></span><span class="footer-link-label">Twitter</span></a></li>
                    <li class="footer-link footer-link--ri"><a href="https://chat.status.im/#/register" target="_blank"><span class="footer-icon"></span><span class="footer-link-label">Riot</span></a></li>
                    <li class="footer-link footer-link--gh"><a href="https://github.com/status-im" target="_blank"><span class="footer-icon"></span><span class="footer-link-label">Github</span></a></li>
                    <li class="footer-link footer-link--rd"><a href="https://www.reddit.com/r/statusim/" target="_blank"><span class="footer-icon"></span><span class="footer-link-label">Reddit</span></a></li>
                    <li class="footer-link footer-link--yt"><a href="https://www.youtube.com/statusim" target="_blank"><span class="footer-icon"></span><span class="footer-link-label">YouTube</span></a></li>
                </ul>
            </div>

            <div class="footer-table__column">
                <p class="footer-header">More</p>
                <ul class="footer-list">
                    <li class="footer-link"><a href="https://status.im/docs/" target="_blank">Status Docs</a></li>
                    <li class="footer-link"><a href="https://our.status.im/" target="_blank">Status Blog</a></li>
                    <li class="footer-link"><a href="https://status.im/contribute/" target="_blank">Jobs</a></li>
                    <li class="footer-link"><a href="https://status.im/privacy-policy.html" target="_blank">Privacy Policy</a></li>
                </ul>
            </div>

            <div class="footer-table__column">
                <p class="footer-header">Projects</p>
                <ul class="footer-list">
                    <li class="footer-link"><a href="https://embark.status.im" target="_blank">Embark</a></li>
                    <li class="footer-link"><a href="https://hardwallet.status.im/" target="_blank">Keycard</a></li>
                    <li class="footer-link"><a href="https://incubate.status.im/" target="_blank">Incubate</a></li>
                    <li class="footer-link"><a href="https://nimbus.status.im/" target="_blank">Nimbus</a></li>
                </ul>
            </div>
        </div>
    
        <div class="footer-logo-wrap">
            <div class="footer-logo-wrap__inner">
                <a class="footer-logo" href="https://status.im" target="_blank"></a>
                <div class="footer-address secondary-text">Status Research & Development GmbH<br>Baarerstrasse 10<br>Zug, Switzerland</div>
            </div>
        </div>
    </div>
</div>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <div class="backdrop"></div>
<div class="mobile-menu-container">
  <div class="mobile-menu-container-inner">
    <div class="mobile-menu-header">
      <div class="logo-wrap">
          <span class="logo-span"><a class="logo" href="/"></a></span>
          <span class="logo-span"><a class="logo-text" href="/">status</a></span>
      </div>
      <a href="#" class="close">
        <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M12 10.574L7.72275 6.2968C7.32616 5.90021 6.68994 5.90241 6.29617 6.29617C5.89966 6.69269 5.90269 7.32864 6.2968 7.72275L10.574 12L6.2968 16.2772C5.90021 16.6738 5.90241 17.3101 6.29617 17.7038C6.69269 18.1003 7.32864 18.0973 7.72275 17.7032L12 13.426L16.2772 17.7032C16.6738 18.0998 17.3101 18.0976 17.7038 17.7038C18.1003 17.3073 18.0973 16.6714 17.7032 16.2772L13.426 12L17.7032 7.72275C18.0998 7.32616 18.0976 6.68994 17.7038 6.29617C17.3073 5.89966 16.6714 5.90269 16.2772 6.2968L12 10.574Z" fill="black"/>
        </svg>
      </a>
    </div>
    <div class="ecosystem">
      <span class="title">Ecosystem</span>
    </div>
    <div class="community">
      <span class="title">Community</span>
    </div>
  </div>
  <div class="mobile-submenu-container-inner">
    <div class="mobile-menu-header">
      <a href="#" class="back">
        <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.00687 12.1016C7.02704 12.3261 7.1228 12.5448 7.29281 12.7143L14.3042 19.7079C14.6926 20.0953 15.3188 20.0988 15.7089 19.7097C16.0963 19.3232 16.0907 18.6911 15.7072 18.3085L9.38119 11.9986L15.7072 5.68865C16.0956 5.30126 16.099 4.67664 15.7089 4.28751C15.3215 3.90107 14.6877 3.9067 14.3042 4.28924L7.29281 11.2828C7.06819 11.5069 6.97231 11.8103 7.00687 12.1016Z" fill="black"/>
        </svg>
      </a>
      <span class="title">Status app</span>
      <a href="#" class="close">
        <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M12 10.574L7.72275 6.2968C7.32616 5.90021 6.68994 5.90241 6.29617 6.29617C5.89966 6.69269 5.90269 7.32864 6.2968 7.72275L10.574 12L6.2968 16.2772C5.90021 16.6738 5.90241 17.3101 6.29617 17.7038C6.69269 18.1003 7.32864 18.0973 7.72275 17.7032L12 13.426L16.2772 17.7032C16.6738 18.0998 17.3101 18.0976 17.7038 17.7038C18.1003 17.3073 18.0973 16.6714 17.7032 16.2772L13.426 12L17.7032 7.72275C18.0998 7.32616 18.0976 6.68994 17.7038 6.29617C17.3073 5.89966 16.6714 5.90269 16.2772 6.2968L12 10.574Z" fill="black"/>
        </svg>
      </a>
    </div>
    <div class="dropdown">
      <nav></nav>
    </div>
  </div>
</div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script src="/js/vendor.min.js"></script>

</body>
</html>
